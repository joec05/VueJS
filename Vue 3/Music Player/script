var audios=document.querySelectorAll('audio');
const { ref, reactive, readonly, computed } = Vue;

var App={
    setup(){
        const selectedloop=reactive({val:'unchanged'});
        const currentindex=reactive({val:0});
        const nowplaying=reactive({val:'Music'});
        const prevplay=reactive({val:0});
        const lists=reactive([
            {name: 'A Whole New World', artist: 'Zayn', playing:false, sidebarshow:false, src:'awholenewworld.mp3'},
            {name: 'Orange', artist: 'Shigatsu', playing:false,  sidebarshow:false, src:'orange.mp3'},
            {name: 'Pretty Boy', artist: 'M2M', playing:false,  sidebarshow:false, src:'pretty-boy.mp3'},
            {name: 'How Have You Been', artist: 'Eric Chou', playing:false,  sidebarshow:false, src:'how-have-you-been.mp3'},
            {name: 'Why', artist: 'Full House', playing:false,  sidebarshow:false, src:'full-house-ost.mp3'}
        ])

        const paste=(index)=>{
            nowplaying.val=lists[index].name+' - '+lists[index].artist;
        }
        const play=(index)=>{
            audios=document.querySelectorAll('audio');
            if(prevplay.val!=index){
            audios[prevplay.val].currentTime=0;
            audios[prevplay.val].pause();
            audios[index].play();
            lists[index].playing=true;
            paste(index);
            prevplay.val=index;
            currentindex.val=index;
          }else{
            if(!lists[index].playing){
              audios[index].play();
              lists[index].playing=true;
              paste(index); currentindex.val=index;
            }else{
              audios[index].pause();
              lists[index].playing=false;
            }
          }
        }
        const next=()=>{
            prevplay.val=currentindex.val;
            audios[prevplay.val].currentTime=0;
            lists[prevplay.val].playing=false;
            currentindex.val++;
            if(currentindex.val==audios.length){currentindex.val=0;}
            play(currentindex.val);
        }
        const prev=()=>{
            prevplay.val=currentindex.val;
            audios[prevplay.val].currentTime=0;
            lists[prevplay.val].playing=false;
            currentindex.val--;
            if(currentindex.val==-1){currentindex.val=audios.length-1;}
            play(currentindex.val);
        }
        const onend=()=>{
            if(selectedloop.val=='unchanged'){
                audios[currentindex.val].currentTime=0;
                audios[currentindex.val].play()}
              else if(selectedloop.val=='increment'){next()}
              else if(selectedloop.val=='random'){
                var getRandom=Math.floor(Math.random()*audios.length);
                audios[currentindex.val].currentTime=0;
                audios[currentindex.val].pause();
                lists[currentindex.val].playing=false;
                paste(getRandom);
                lists[getRandom].playing=true;
                audios[getRandom].play();
                currentindex.val=getRandom;
                prevplay.val=getRandom;
              }
        }
        
        return { selectedloop, currentindex, nowplaying, prevplay, lists, paste, play, next, prev, onend }
    }
}

Vue.createApp(App).mount('#music-player');
